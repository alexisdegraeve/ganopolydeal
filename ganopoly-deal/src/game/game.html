@if (!startGame) {
<div class="options">
    <button class="btn btn-danger" (click)="newGame()">New Game</button>
    <button class="btn btn-danger" [routerLink]="['/rules']">Rules</button>
    <!-- <button class="btn btn-primary" (click)="remove()">REMOVE</button> -->
</div>
} @if (startGame) {
<div class="options  mb-4">
    <button class="btn btn-danger" (click)="stopGame()">Stop Game</button>
    <!-- <button class="btn btn-primary" (click)="remove()">REMOVE</button> -->
</div>
<div class="game ">

    @if (players$ | async; as players) { @for(player of players; track $index) {


    <div class="player ">
        <div class="player-name "><span class="name">
         @if(player.name.toLowerCase() !== 'human') {
                <i class="bi bi-robot me-2"></i>
                }@else {
                <i class="bi bi-house-door-fill me-2"></i>
        }
      {{ player.name}}</span> You can find money, properties, and action cards.</div>

        @if(player.name.toLowerCase() === 'human') { @if(alertMessage) { }

        <div class="alert alert-warning alert-dismissible fade show" role="alert">
            {{ alertMessage }}
            <button type="button" class="btn-close" aria-label="Close" (click)="alertMessage = null"></button>
        </div>
        <div class="player-cards ">
            @for(card of player.hand; track $index) {

            <ganopoly-card [readOnly]="false" [players]="players" [card]="card " (selectionChange)="onCardSelectionChange($event) "></ganopoly-card>


            }

            <div class="player-infos">
                @if (selectedCards.length > 3) {
                <p class="text-danger ">Max 3 cards selected</p>
                } @if((currentPlayerIndex | async) === 3) {<button [disabled]="selectedCards.length> 3" class="btn btn-success" (click)="endturn()">END TURN</button> }
            </div>

        </div>
        } @else {

        <div class="player-cards ">
            <span>Total: x{{ player.hand.length }}</span>
            <ganopoly-card [clickable]="false" [showFront]="false" [readOnly]="true"></ganopoly-card>
        </div>
        }


        <div class="player-money"> <span class="title">Money</span> @for(card of player.money; track $index) {
            <ganopoly-card [card]="card"></ganopoly-card>
            }

        </div>
        <div class="player-properties"> <span class="title">Properties</span> @for(card of player.properties; track $index) {
            <ganopoly-card [card]="card"></ganopoly-card>
            }

        </div>


    </div>
    } } @if (startGame && (remainingDeck$ | async); as remainingDeck) {

    <div class="player">
        <div class="player-name"><span class="name">Draw Pile</span></div> @if(lastCard$ | async; as lastCard) {
        <ganopoly-card [card]="lastCard"></ganopoly-card>
        }
        <!-- @if(totalCardsHuman$ | async; as total) {
        <div>
            <button class="btn btn-primary" (click)="takeCards(2, 'human')">Take 2 Cards </button>
        </div>
        } @else {
        <button class="btn btn-primary" (click)="takeCards(5, 'human')">Take 5 Cards </button> } -->

    </div>
    }

    <div class="player">
        <div class="player-name"><span class="name">Action Pile</span></div> @if(lastActionCard$ | async; as lastActionCard) {
        <ganopoly-card [card]="lastActionCard"></ganopoly-card>
        }
        <!-- @if(totalCardsHuman$ | async; as total) {
        <div>
            <button class="btn btn-primary" (click)="takeCards(2, 'human')">Take 2 Cards </button>
        </div>
        } @else {
        <button class="btn btn-primary" (click)="takeCards(5, 'human')">Take 5 Cards </button> } -->

    </div>

    <div class="debug">
        Remaining DECK @if (remainingDeck$ | async; as remainingDeck) { @for(card of remainingDeck; track $index) {
        <ganopoly-card [card]="card"></ganopoly-card>
        } }
    </div>

</div>
}
