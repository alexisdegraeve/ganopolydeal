 @if (gameOverReason === 'win' && winner) {
<div class="win-screen text-center p-5">
    @if(winner.name.toLowerCase() === 'human') {
    <div class="ganopoly-deal-win">

    </div>
    <h2>Congratulations! You won!</h2>
    } @else {
    <div class="ganopoly-deal-lose">

    </div>
    <h2>Game Over! {{ winner.name }} won!</h2>
    }
</div>
}

<!-- DRAW SCREEN -->
@if (gameOverReason === 'draw') {
<div class="draw-screen text-center p-5">
    <div class="ganopoly-deal-draw">

    </div>
</div>
} @if (!startGame) {
<div class="options">
    <button class="btn btn-danger" (click)="newGame()">New Game</button>
    <button class="btn btn-danger" [routerLink]="['/rules']">Rules</button>
    <!-- <button class="btn btn-primary" (click)="remove()">REMOVE</button> -->
</div>
} @if (startGame) {
<div class="options  mb-4">
    <button class="btn btn-danger" (click)="stopGame()">Stop Game</button>
    <!-- <button class="btn btn-primary" (click)="remove()">REMOVE</button> -->
</div>

@if (startGame && !gameOverReason) {
<div class="game ">

    @if (players$ | async; as players) { @for(player of players; track $index) {


    <div class="player ">
        <div class="player-name "><span class="name">
         @if(player.name.toLowerCase() !== 'human') {
                <i class="bi bi-robot me-2"></i>
                }@else {
                <i class="bi bi-house-door-fill me-2"></i>
        }
      {{ player.name}}</span> You can find money, properties, and action cards.</div>



        @if(player.name.toLowerCase() === 'human') {

        <div class="player-infos">
            @if (player.hand.length - selectedCards$.getValue().length > 7) {
            <div class="alert alert-warning" role="alert">You must play cards until you have at most 7 cards in hand.</div>
            } @if (selectedCards$.getValue().length > 3) {
            <div class="alert alert-warning" role="alert">You can select a maximum of 3 cards.</div>
            } @if((currentPlayerIndex | async) === 2) {<button [disabled]="isEndTurnDisabled(player)" class="btn btn-success" (click)="endturn()">END TURN</button> }
        </div>


        @if(alertMessage) {
        <div class="alert alert-warning alert-dismissible fade show" role="alert">
            {{ alertMessage }}
        </div>}


        <div class="player-cards ">
            @for(card of player.hand; track $index) {

            <ganopoly-card [selectedCards$]="selectedCards$" [readOnly]="false" [players]="players" [card]="card " (selectionChange)="onCardSelectionChange($event) "></ganopoly-card>
            }



        </div>
        } @else { @if(player.name.toLowerCase() !== 'human') { @if (iaMessages$ | async; as messages;) { @if(messages[player.id]) {
        <div class="alert alert-info">
            {{ messages[player.id] }}
        </div>
        } } }

        <div class="player-cards ">
            <span>Total: x{{ player.hand.length }}</span>
            <ganopoly-card [clickable]="false" [showFront]="false" [readOnly]="true"></ganopoly-card>
        </div>
        }


        <div class="player-money">
            <span class="title">Money</span> @for(group of groupMoney(player); track group.value) {
            <div class="money-group">
                <div class="group-title">ðŸ’° {{ group.value }}M</div>
                <div class="group-stack">
                    @for(card of group.cards; track card.id) {
                    <ganopoly-card [card]="card"></ganopoly-card>
                    }
                </div>
            </div>
            }
        </div>
        <div class="player-properties">
            <span class="title">Properties</span> @for(group of groupProperties(player); track group.color) {
            <div class="property-group" [attr.data-color]="group.color">
                <div class="group-title" [class.complete]="isGroupComplete(group)">{{ group.color }}</div>

                <div class="group-stack">
                    @for(card of group.cards; track card.id) {
                    <ganopoly-card [card]="card"></ganopoly-card>
                    }
                </div>
            </div>
            }
        </div>



    </div>
    } } @if (startGame && (remainingDeck$ | async); as remainingDeck) {

    <div class="player">
        <div class="player-name"><span class="name">Draw Pile</span></div> @if(lastCard$ | async; as lastCard) {
        <ganopoly-card [card]="lastCard"></ganopoly-card>
        }
        <!-- @if(totalCardsHuman$ | async; as total) {
        <div>
            <button class="btn btn-primary" (click)="takeCards(2, 'human')">Take 2 Cards </button>
        </div>
        } @else {
        <button class="btn btn-primary" (click)="takeCards(5, 'human')">Take 5 Cards </button> } -->

    </div>
    }

    <div class="player">
        <div class="player-name"><span class="name">Action Stack</span></div> @if(lastActionCard$ | async; as lastActionCard) {
        <ganopoly-card [card]="lastActionCard"></ganopoly-card>
        } @else { <span>No actions played yet.</span> }
        <!-- @if(totalCardsHuman$ | async; as total) {
        <div>
            <button class="btn btn-primary" (click)="takeCards(2, 'human')">Take 2 Cards </button>
        </div>
        } @else {
        <button class="btn btn-primary" (click)="takeCards(5, 'human')">Take 5 Cards </button> } -->

    </div>
    <!--
    <div class="debug">
        Remaining DECK @if (remainingDeck$ | async; as remainingDeck) { @for(card of remainingDeck; track $index) {
        <ganopoly-card [card]="card"></ganopoly-card>
        } }
    </div>
    -->
</div>
} }
